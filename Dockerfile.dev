# =============================================
# Development Dockerfile for Shipment Tracking API
# With hot reload and debugging support
# =============================================

FROM node:20-bookworm

# Install system dependencies for Playwright
RUN apt-get update && apt-get install -y \
    xvfb \
    && npx playwright install-deps firefox \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY tsconfig.json ./
COPY nodemon.json ./

# Install ALL dependencies (including devDependencies)
# Install Playwright browsers
RUN npm install && npx playwright install firefox

# Copy source code
COPY . .

# Expose port
EXPOSE 8080

# Set environment variables
ENV NODE_ENV=development
ENV DISPLAY=:99

# Start Xvfb and development server with hot reload
CMD ["sh", "-c", "Xvfb :99 -screen 0 1920x1080x24 & npm run dev"]
